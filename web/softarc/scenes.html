<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Scenes - Beosound 5c</title>

    <!-- Favicons -->
    <link rel="icon" type="image/x-icon" href="../assets/favicons/favicon.ico">
    <link rel="icon" type="image/png" sizes="16x16" href="../assets/favicons/favicon-16x16.png">
    <link rel="icon" type="image/png" sizes="32x32" href="../assets/favicons/favicon-32x32.png">
    <link rel="apple-touch-icon" sizes="180x180" href="../assets/favicons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="192x192" href="../assets/favicons/android-chrome-192x192.png">
    <link rel="icon" type="image/png" sizes="512x512" href="../assets/favicons/android-chrome-512x512.png">
    <link rel="manifest" href="../assets/favicons/site.webmanifest">
    <meta name="theme-color" content="#000000">

    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="../assets/phosphor/phosphor.css">
</head>
<body>
    <div id="app">
        <div class="counter">
            <div id="counter-path"></div>
            <span id="current-item">1</span> / <span id="total-items">8</span>
        </div>
        <div class="hierarchy-depth-1" id="hierarchy-background"></div>
        <div class="arc-container" id="arc-container"></div>
    </div>

    <script src="../js/config.js"></script>
    <script src="../js/arc-utils.js"></script>
    <script src="../js/emulator-bridge.js"></script>
    <script src="script-v2.js"></script>
    <script>
        // Map a scene object to an ArcList item (supports both icon and legacy image)
        function mapScene(scene) {
            const item = { id: scene.id, name: scene.name, actionable: true };
            if (scene.icon) {
                item.icon = scene.icon;
                item.color = scene.color || '#fff';
            } else if (scene.image) {
                item.image = scene.image;
            }
            if (scene.scenes) item.scenes = scene.scenes;
            return item;
        }

        document.addEventListener('DOMContentLoaded', async () => {
            try {
                let scenesData;
                if (typeof AppConfig !== 'undefined' && AppConfig.scenes) {
                    scenesData = AppConfig.scenes;
                } else {
                    // Load scenes from config.json (../json/ works from softarc iframe)
                    // Falls back to example scenes if no config found
                    let resp = await fetch('../json/config.json').catch(() => null);
                    if (resp && resp.ok) {
                        const config = await resp.json();
                        scenesData = config.scenes;
                    }
                    if (!scenesData) {
                        const fallback = (typeof AppConfig !== 'undefined' && AppConfig.scenesFile)
                            ? AppConfig.scenesFile
                            : '../json/scenes.example.json';
                        resp = await fetch(fallback);
                        scenesData = await resp.json();
                    }
                }

                window.arcListInstance = new ArcList({
                    inlineData: scenesData,
                    levels: [{
                        itemMapper: mapScene,
                        childrenKey: 'scenes',
                        isContainer: (item) => item.scenes?.length > 0,
                    }],  // Single level reused recursively â€” scenes can nest infinitely
                    storagePrefix: 'scenes_arclist',
                    context: 'scenes',
                    webhookUrl: typeof AppConfig !== 'undefined' ? AppConfig.webhookUrl : null,
                });
            } catch (error) {
                console.error('Scenes initialization error:', error);
                document.body.innerHTML = '<div style="color:red;padding:20px;">Error: ' + error.message + '</div>';
            }
        });
    </script>
</body>
</html>
